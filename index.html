<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*</title>
<style>
  body {
    margin: 0;
    background: #000;
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    user-select: none;
  }

  #textWrapper {
    transform-origin: center center;
    max-width: 100vw;
    max-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #textInput {
    outline: none;
    border: none;
    background: #000;
    color: #fff;
    white-space: nowrap;
    line-height: 1;
    font-weight: 400;
    min-width: 1ch;
    font-family: "Times New Roman", Times, serif;
  }

  #controlsBarOuter {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    pointer-events: none;
  }

  #controlsBar {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    font-size: 14px;
    color: #fff;
    background: transparent;
    display: flex;
    gap: 1rem;
    padding: 0.75rem 1rem 1.25rem;
    opacity: 0;
    transition: opacity 0.15s linear;
    pointer-events: auto;
  }

  #controlsBarOuter:hover #controlsBar,
  #controlsBar:hover {
    opacity: 1;
  }

  .ctrlBtn {
    cursor: pointer;
    user-select: none;
    background: none;
    border: none;
    padding: 0;
    color: #fff;
    font-size: 14px;
    line-height: 1;
    font-weight: 400;
  }

  .ctrlBtn:active {
    opacity: 0.5;
  }

  #hint {
    font-size: 12px;
    opacity: 0.5;
    cursor: default;
  }

  #slideHint {
    font-size: 12px;
    opacity: 0.5;
    cursor: default;
  }
</style>
</head>
<body>

<div id="textWrapper">
  <div id="textInput" contenteditable="true" spellcheck="false"></div>
</div>

<div id="controlsBarOuter">
  <div id="controlsBar">
    <button class="ctrlBtn" id="fontInc">Ôºã</button>
    <button class="ctrlBtn" id="fontDec">Ôºç</button>
    <button class="ctrlBtn" id="clearBtn">üóë</button>
    <div id="hint">cmd+‚å´ clear</div>
    <div id="slideHint">cmd+‚Üê / cmd+‚Üí slide</div>
  </div>
</div>

<script>
(function() {
  let baseFontSize = 60;
  const MIN_FONT = 20;
  const MAX_FONT = 200;

  const STORAGE_KEY_TEXT = "simplepad_text_v1";
  const STORAGE_KEY_FONT = "simplepad_font_v1";
  const STORAGE_KEY_SLIDE = "simplepad_slide_v1";

  const textWrapper = document.getElementById("textWrapper");
  const textInput   = document.getElementById("textInput");

  let slides = [ null ];
  let currentSlide = 0;

  try {
    const savedText = window.localStorage.getItem(STORAGE_KEY_TEXT);
    if (savedText !== null) {
      textInput.textContent = savedText;
    }
    const savedFont = window.localStorage.getItem(STORAGE_KEY_FONT);
    if (savedFont !== null) {
      const n = parseInt(savedFont, 10);
      if (!isNaN(n)) baseFontSize = n;
    }
    const savedSlide = window.localStorage.getItem(STORAGE_KEY_SLIDE);
    if (savedSlide !== null) {
      const s = parseInt(savedSlide, 10);
      if (!isNaN(s)) currentSlide = s;
    }
  } catch (e) {}

  function applyBaseFont() {
    textInput.style.fontSize = baseFontSize + "px";
  }

  function applySlide() {
    if (slides.length === 0) {
      document.body.style.background = "#000";
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center center";
      document.body.style.backgroundRepeat = "no-repeat";
      return;
    }

    if (currentSlide < 0) currentSlide = 0;
    if (currentSlide >= slides.length) currentSlide = slides.length - 1;

    const img = slides[currentSlide];

    if (!img) {
      document.body.style.background = "#000";
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center center";
      document.body.style.backgroundRepeat = "no-repeat";
    } else {
      document.body.style.background = "#000 url('" + img + "') center center / cover no-repeat";
    }

    persist();
  }

  function persist() {
    try {
      window.localStorage.setItem(STORAGE_KEY_TEXT, textInput.textContent);
      window.localStorage.setItem(STORAGE_KEY_FONT, String(baseFontSize));
      window.localStorage.setItem(STORAGE_KEY_SLIDE, String(currentSlide));
    } catch (e) {}
  }

  // function fitToScreen() {
  //   textWrapper.style.transform = "scale(1)";
  //   const rect = textWrapper.getBoundingClientRect();
  //   const vw = window.innerWidth;
  //   const vh = window.innerHeight;
  //   const scaleX = vw / rect.width;
  //   const scaleY = vh / rect.height;
  //   const scale = Math.min(1, scaleX, scaleY);
  //   textWrapper.style.transform = "scale(" + scale + ")";
  // }

  function clearAll() {
    textInput.textContent = "";
    persist();
    // requestAnimationFrame(fitToScreen);
  }

  function enforceWidthLimit() {
    const rect = textWrapper.getBoundingClientRect();
    const vw = window.innerWidth;
    if (rect.width >= vw) {
      clearAll();
    }
  }

  function handleChange() {
    if (textInput.textContent.indexOf("\n") !== -1) {
      textInput.textContent = textInput.textContent.replace(/[\r\n]+/g, " ");
    }
    enforceWidthLimit();
    persist();
    // requestAnimationFrame(fitToScreen);
  }

  function insertTextAtCursor(text) {
    document.execCommand("insertText", false, text);
  }

  function changeFont(delta) {
    baseFontSize = clamp(baseFontSize + delta, MIN_FONT, MAX_FONT);
    applyBaseFont();
    persist();
    // requestAnimationFrame(fitToScreen);
  }

  function clamp(v, lo, hi) {
    return v < lo ? lo : (v > hi ? hi : v);
  }

  function nextSlide() {
    if (slides.length === 0) return;
    if (currentSlide < slides.length - 1) {
      currentSlide = currentSlide + 1;
      applySlide();
    }
  }

  function prevSlide() {
    if (slides.length === 0) return;
    if (currentSlide > 0) {
      currentSlide = currentSlide - 1;
      applySlide();
    }
  }

  function probeImageExists(src) {
    return new Promise(function(resolve) {
      const img = new Image();
      img.onload = function() { resolve(true); };
      img.onerror = function() { resolve(false); };
      img.src = src + "?cachebust=" + Date.now();
    });
  }

  async function buildSlides() {
    const found = [];
    let consecutiveMisses = 0;
    const MAX_CONSECUTIVE_MISSES = 10;
    const MAX_INDEX = 200;

    for (let i = 1; i <= MAX_INDEX; i++) {
      const name = i + ".jpg";
      const okJpg = await probeImageExists(name);
      if (okJpg) {
        found.push(name);
        consecutiveMisses = 0;
      } else {
        consecutiveMisses++;
      }
      if (consecutiveMisses >= MAX_CONSECUTIVE_MISSES) {
        break;
      }
    }

    const seq = [];
    for (let i = 0; i < found.length; i++) {
      seq.push(null);
      seq.push(found[i]);
    }
    seq.push(null);

    if (seq.length === 0) {
      seq.push(null);
    }

    slides = seq;

    if (currentSlide < 0 || currentSlide >= slides.length) {
      currentSlide = 0;
    }

    applySlide();
  }

  textInput.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
    }

    const isDeleteKey = (e.key === "Backspace" || e.key === "Delete");
    const isMeta = (e.metaKey || e.ctrlKey);

    if (isDeleteKey && isMeta) {
      e.preventDefault();
      clearAll();
      return;
    }

    if (isMeta && (e.key === "ArrowRight" || e.key === "Right")) {
      e.preventDefault();
      nextSlide();
      return;
    }

    if (isMeta && (e.key === "ArrowLeft" || e.key === "Left")) {
      e.preventDefault();
      prevSlide();
      return;
    }
  });

  textInput.addEventListener("paste", function(e) {
    e.preventDefault();
    let text = (e.clipboardData || window.clipboardData).getData("text");
    text = text.replace(/[\r\n]+/g, " ");
    insertTextAtCursor(text);
    handleChange();
  });

  textInput.addEventListener("input", handleChange);
  textInput.addEventListener("keyup", handleChange);

  document.getElementById("fontInc").addEventListener("click", function() {
    changeFont(+10);
  });

  document.getElementById("fontDec").addEventListener("click", function() {
    changeFont(-10);
  });

  document.getElementById("clearBtn").addEventListener("click", function() {
    clearAll();
  });

  // window.addEventListener("resize", function() {
  //   requestAnimationFrame(fitToScreen);
  // });

  applyBaseFont();
  // requestAnimationFrame(fitToScreen);
  textInput.focus();
  buildSlides();
})();
</script>

</body>
</html>
